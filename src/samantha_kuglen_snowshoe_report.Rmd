---
title: "Assignment 4 - Task 2"
author: "Samantha Kuglen"
date: "11/5/2021"
output: html_document
---
### A. Overview
This report is an exploratory review of counts and sizes of juvenile snowshoe hares (*Lepus americanus*), recorded at the [Bonanza Creek Experimental Forest (US Long Term Ecological Research Site)](https://www.lter.uaf.edu/) from 1998 - 2012. This report provides analyses on juvenile hare 1) annual trap counts, 2) weight comparison and 3) relationship between weight and hind foot length. This data is important because snowshoe hares are a keystone species in northern boreal forests. The purpose of this analysis is to explore reasons that this species may experience population fluctuations.

### B. Data and Analysis
- Describe Data

#### Statistical Methods and Tools

**Data Citation: ** Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. Snowshoe hare physical data in Bonanza Creek Experimental Forest: 1999-Present ver 22. Environmental Data Initiative. https://doi.org/10.6073/pasta/03dce4856d79b91557d8e6ce2cbcdc14


```{r setup, include=FALSE, warning = FALSE, message = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE)

# Attach packages
library(tidyverse)
library(here)
library(broom)
library(janitor)
library(lubridate)
library(ggplot2)
library(effsize)
library(kableExtra)
```

```{r read in data}
# Store Bonanza Hares csv as new object `hare_data`, update date to YYYY-MM-DD format, create new column `year`, add corresponding sex and site names 
juvenile_hares <- read_csv(here("data", "bonanza_hares.csv")) %>% 
  filter(age == "j") %>% 
  mutate(date = mdy(date)) %>% 
  mutate(year = year(date)) %>% 
  mutate(site_names = case_when( # add new column for site names
    grid %in% c("bonrip") ~ "Bonanza Riparian",
    grid %in% c("bonmat") ~ "Bonanza Mature",
    grid %in% c("bonbs") ~ "Bonanza Black Spruce" 
  )) %>% 
  mutate(sex = case_when( # update coluimn for sex
    sex %in% c("m") ~ "Male",
    sex %in% c("f") ~ "Female",
    sex %in% c("NA") ~ "NA"
  ))
```


```{r}
# Count the total # of juvenile hare trappings during each year of the study
hare_counts <- juvenile_hares %>% 
  group_by(year) %>% 
  summarize(sample_size = n()) 

# Mean, median, max, min, of juvenile hares trapped
hare_stats <- hare_counts %>% 
  summarize(mean = round(mean(sample_size), 1),
            median = round(median(sample_size), 1),
            sd = round(sd(sample_size), 1),
            max = max(sample_size),
            min = min(sample_size)) 
  
```

### C. Preliminary results
#### I: Data visualization of annual juvenile hare trap counts 
```{r, fig.cap='cap'}
# Finalized data visualization of the juvenile hare counts by year
ggplot(hare_counts, aes(x = year, y = sample_size)) +
  geom_col(color = "#037bfc", 
           fill = "#037bfc",
           alpha = 0.75) +
  scale_x_continuous(breaks = 1999:2012) + 
  scale_y_continuous(breaks = seq(min(0), max(130), by = 10)) +
  labs(x = "Year",
       y = "Number of Hares",
       title = "Annual Juvenile Hare Trap Counts (KUGLEN)") +
  theme_minimal() +
  theme(plot.title = element_text(hjust = 0.5),
        legend.position = "none")

```
Major takeaways from the graph about total snowshoe hare trappings: 
- The minimum and maximum counts of juvenile hare trappings
- Mean and median annual number of juvenile hares trapped
- Notable trends include
- Moving forward, to standardize the juvenile hare population in future analyses

#### II: Juvenile weight comparison of male & female snowshoe hares
Finalized data visualizations comparing juvenile hare weights by sex and site and omitting other variables and including groups where variables are not recorded (`NA`)
```{r}
ggplot(juvenile_hares) + 
  geom_histogram(alpha = 0.5, aes(x = weight, fill = sex, color = sex)) + 
  facet_wrap(~site_names) +
  scale_fill_manual(values = c("#af85ff", "#5bb9de", "#6c7375")) +
  scale_color_manual(values = c("#8c63db", "#4c9bba", "#474b4d")) +
  labs(x = "Weight (g)",
       y = "Count",
       title = "Juvenile Snowshoe Hare Weight Comparison (KUGLEN)",
       subtitle = "1999 - 2012",
       color = "Sex",
       fill = "Sex") + # prevent redundant legend
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(plot.subtitle = element_text(hjust = 0.5)) +
  theme_linedraw()
```
**Figure 2.** Snowshoe hare weight distribution by sex in Bonanza Creek, Alaska. Data: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017. '

Main takeaways from the graph for audience to understand:

#### III: Descriptive statistics of juvenile weight comparison 
Finalized table containing the mean, standard deviation, and sample size for male and female juvenile snowshoe hares.


**Table 1.** Descriptive statistics (mean, standard deviation, and sample size) for male and female juvenile snowshoe hares. Data: Kielland, K., F.S. Chapin, R.W. Ruess, and Bonanza Creek LTER. 2017.
```{r}
weight_stats <- juvenile_hares %>% 
    group_by(sex) %>% 
    select(sex, weight) %>% 
    summarize(mean = round(mean(weight, na.rm = TRUE), 1),
              sd = round(sd(weight, na.rm = TRUE), 1),
              hare_sample_size = n())

kable(weight_stats, 
      col = c("Sex",
              "Mean Weight (g)",
              "Standard Deviation",
              "Sample Size")) %>% 
      kable_styling(bootstrap_options = "striped", 
                    full_width = FALSE)

```

```{r weight comparison cohen and ttest, include=FALSE}
# Pull individual weights from male and female for direct mean comparison
male_hares <- juvenile_hares %>% 
  filter(sex == "Male", age == "j") %>% 
  filter(!is.na(weight)) %>% 
  pull(weight)

female_hares <- juvenile_hares %>% 
  filter(sex == "Female", age == "j") %>% 
  filter(!is.na(weight)) %>% 
  pull(weight)

mean_difference <- weight_stats$mean[2] - weight_stats$mean[1]

# Cohen and t-test
cohen_hares <- cohen.d(female_hares, male_hares)

hare_ttest <- t.test(male_hares, female_hares)

tidy_hare_ttest <-tidy(hare_ttest)

# Exploratory graphs (histogram, QQ-plot) to explore assumptions of t-test
hist(male_hares) # normal
hist(female_hares) # normal
qqnorm(male_hares) # slightly curved, mostly normal
qqnorm(female_hares) # normal
```

The mean for male weights (`r round(hare_ttest$estimate[1],1)` g) is greater than that of juvenile hares (`r round(hare_ttest$estimate[2],1)` g). The absolute difference in means is `r mean_difference`g and the difference is statistically significant (Welch's two-sample t-test: t = `r round(hare_ttest$statistic, 2`), p = 0.007). The effect size is small (Cohen's *d* = `r round(cohen_hares$estimate),1`)

#### IV: Relationship between juvenile weight & hind foot length                                                                                     
Exploration of the relationship between juvenile snowshoe hare hind foot length (mm) and weight of all juvenile hares in the study.
```{r}
# Final visualization of juvenile hare hind foot length versus weight.
ggplot(juvenile_hares, aes(x = hindft, y = weight)) + 
  geom_point(aes(color = sex)) + 
  geom_smooth(method = "lm", color = "black") +
  labs(x = "Hindfoot Length (mm)",
       y = "Weight (g)",
       title = "Relationship Between Snowshoe Hare Weight and Hindfoot Length (KUGLEN)",
       #subtitle = "1999 - 2012",
       color = "Sex") +
  theme(plot.title = element_text(hjust = 0.5)) +
  theme(plot.subtitle = element_text(hjust = 0.5)) +
  theme_linedraw()

```

```{r pearsons and linear regression, include = FALSE}

# Pearson's r correlation
cor_hare <- cor.test(juvenile_hares$weight, juvenile_hares$hindft)
cor_hare_tidy <- tidy(cor_hare)

# Linear Regression to describe how juvenile snowshoe hare weight changes with respect to hind foot length. 
lm_hares <- lm(weight ~ hindft, data = juvenile_hares)
plot(lm_hares)

```

### Summary
